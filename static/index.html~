<html>
    <head>
        <title>ShareJS Tutorial</title>
        <script src="bcsocket.js"></script>             <!-- add transport -->
        <script src="webclient/share.js"></script>      <!-- ShareJS -->
	<script src="webclient/json.js"></script>
	<script type="text/javascript" src="jstree-v.pre1.0/_lib/jquery.js"></script>
	<script type="text/javascript" src="jstree-v.pre1.0/jquery.jstree.js"></script>
    </head>
    <body>
	<h3>TOC Elements</h3>
	<div id="toc-items">
		<ul>
			<li>
				<a href="#">Stack Overflow</a>
			</li>			
			<li>
				<a href="#">Ask Ubuntu</a>
			</li>
			<li>
				<a href="#">Chapter</a>
			</li>
		</ul>
	</div>
	<h3>TOC</h3>
	<div id="toc">
		<ul id="tocTopLevel">

		</ul>
	</div>

        <script>
            // connect to the server
            sharejs.open('book1', 'json', function(error, doc) {
                // this function is called once the connection is opened
                if (error) {
			console.log("ERROR:", error);
			return;
                }
		
		var toc = doc.get();

		if (toc == null) {
			toc = {children: [{name: "Book"}]};			
		}

		addChild(jQuery('#tocTopLevel'), toc);	

		doc.on('child op', function (path, op) {
		  	if (op == 'add') {

			} else if (op == 'move') {

			}
		});

		jQuery("#toc-items").jstree({				
			plugins : [ "themes", "html_data", "dnd" ]
		});
		
		jQuery("#toc").jstree({
			"crrm": { "move": { "always_copy": "multitree" } },
			"dnd" : {
		            "drop_target" : false,
		            "drag_target" : false
			},
			plugins : [ "themes", "html_data", "crrm", "dnd" ]
		});

            });

		function addChild(parent, child) {
			if (child != null && child.children != null) {
				jQuery.each(child.children, function(i, tocElement) {								
					var listItem = jQuery('<li>').text(child.children[i].name);
					var unorderedList = jQuery('<ul>');
					parent.append(listItem);
					listItem.append(unorderedList);
					addChild(unorderedList, child.children[i]);
				});
			}		
		}
        </script>
    </body>
</html>
